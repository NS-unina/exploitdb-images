import csv
from matplotlib import pyplot as plt
import numpy as np
from collections import Counter
import requests

languages = []
lang_txt = []

def get_language(exploit):
    master = "https://raw.githubusercontent.com/offensive-security/exploitdb/master/"+exploit
    req = requests.get(master)
    req = req.text.split('\n')
    
    
    for line in req:
        if line.startswith("#!/"):
            tmp = line.split("/")
            lang_txt.append(tmp[len(tmp)-1])

with open('files_exploits.csv', encoding='utf-8', newline='') as f:
    lettore = csv.reader(f, delimiter=',')

    for riga in lettore:
        ext = riga[1].split(".")
        if len(ext)>1:
            languages.append(ext[1])
            if(ext[1]=="txt"):
                get_language(riga[1])

lang = Counter(languages)
print(lang)

# Data to plot
labels = []
sizes = []

for x, y in lang.items():
    labels.append(x)
    sizes.append(y)

# Plot
plt.pie(sizes, labels=labels)

plt.axis('equal')
plt.show()

lang_ = Counter(lang_txt)
print(lang_)