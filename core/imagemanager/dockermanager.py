from threading import local
import docker
import os

client = docker.from_env()

def build_image(local_folder):
    tag = os.path.basename(local_folder)+':py'
    client.images.build(
    path = local_folder,
    tag=tag,
    dockerfile = 'Dockerfile'
    )
    return tag

def run_container(tag):
    container = client.containers.run(image=tag, detach=True)
    result = container.wait(condition='not-running')['StatusCode']
    run_logs = container.logs(stdout=True, stderr=True).decode().strip()
    print(run_logs)
    container.remove()
    return result

def test_exploit(local_folder):
    tag = build_image(local_folder)
    result = run_container(tag)
    return result