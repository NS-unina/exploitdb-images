import pandas as pd
import subprocess

#Get snippet language from extension or with 'file' command
def get_language(exploit):
    if exploit.split('.')[1] == 'txt':
        cmd = "file ../"+ exploit
        language = str(subprocess.check_output(cmd, shell=True))
        language = language.split(": ")[1].split()[0].lower()
        if(language == "python"):
            language = "py"
        elif(language == "c++"):
            language = "cpp"
        elif(language == "ruby"):
            language = "rb"
        elif(language == "exported"):
            language = "sgml"
        elif(language == "unified"):
            language = "diff"
        elif(language == "perl5"):
            language = "perl"
    else:
        language = exploit.split('.')[1]
    return language


#Read csv
df = pd.read_csv('files_exploits.csv')
#Add new column for snippet extension
df['ext'] = df['file'].str.split('.', n=1, expand=True)[1]

#Add new column for snippet language
df['language'] = df['file'].apply(get_language)

#Save edited dataset on new csv
df.to_csv('files_exploit_lang.csv')