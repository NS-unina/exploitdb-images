import sys
sys.path.append('..')
from core.imagemanager import dockermanager

import pandas as pd
import os


def get_exploit_folder(file):
    filename = os.path.basename(file)
    folder = os.path.join('..', 'exploits',filename)
    return folder


#Read csv
df = pd.read_csv('python_exploits.csv')

#Add new column for exit_code
df['exit_code'] = df['file'].apply(get_exploit_folder).apply(dockermanager.test_exploit)

#Save edited dataset on new csv
df_test = df[['id', 'exit_code']]
path_test_csv = os.path.join('results', 'exit_code.csv')
df_test.to_csv(path_test_csv, index=False)

percentage = (df_test['exit_code'].value_counts()/df_test['exit_code'].count())*100
print('Percentage of exit_codes: ')
print(percentage)
percentage.to_csv(os.path.join('results','exit_code_statistics.csv'))

#TO DO: Add plot for exit codes
