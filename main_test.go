package main

import (
	"encoding/csv"
	"fmt"
	"log"
	"os"
	"strconv"
	"testing"
)

func TestProgram(t *testing.T) {
	main()
}

func TestMain(m *testing.M) {
	csv_data := []string{"id", "exit_code"}

	// create a csv file
	file, err := os.Create("test_result.csv")
	if err != nil {
		log.Fatal(err)
	}
	defer file.Close()

	// initialize csv writer
	writer := csv.NewWriter(file)

	writer.Write(csv_data)
	writer.Flush()

	//execute test
	exitVal := m.Run()

	// write single row
	extraData := []string{"46645", strconv.Itoa(exitVal)}
	writer.Write(extraData)

	fmt.Println("ok")

	writer.Flush()
	file.Close()

	os.Exit(exitVal)
}
